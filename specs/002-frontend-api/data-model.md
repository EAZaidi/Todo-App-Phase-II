# Data Model: Frontend Application & API Integration

**Feature**: 002-frontend-api
**Date**: 2026-01-10
**Status**: Complete

## Overview

This document defines the frontend data models that mirror the backend API contract. All types are derived from the backend specification (001-backend-todo-api) to ensure contract alignment.

---

## Core Entities

### Task

The primary entity representing a todo item in the frontend.

```typescript
/**
 * Task entity as received from the backend API.
 * Matches TaskResponse schema from backend.
 */
interface Task {
  /** Unique task identifier (auto-generated by backend) */
  id: number;

  /** User who owns the task (for data isolation) */
  user_id: string;

  /** Task title (1-500 characters, required) */
  title: string;

  /** Detailed task description (optional, max 5000 characters) */
  description: string | null;

  /** Task completion status */
  completed: boolean;

  /** ISO 8601 timestamp when task was created */
  created_at: string;

  /** ISO 8601 timestamp when task was last updated */
  updated_at: string;
}
```

### Task Display State

Extended task model for UI state management.

```typescript
/**
 * Task with additional UI state properties.
 */
interface TaskDisplayState extends Task {
  /** Whether this task is currently being edited */
  isEditing?: boolean;

  /** Whether an operation is pending for this task */
  isPending?: boolean;

  /** Optimistic completion state (before API confirms) */
  optimisticCompleted?: boolean;
}
```

---

## API Request/Response Types

### Create Task

```typescript
/**
 * Request body for creating a new task.
 * POST /api/users/{user_id}/tasks
 */
interface TaskCreateRequest {
  /** Task title (required, 1-500 chars, non-empty) */
  title: string;

  /** Task description (optional, max 5000 chars) */
  description?: string | null;
}
```

### Update Task (Full)

```typescript
/**
 * Request body for full task update.
 * PUT /api/users/{user_id}/tasks/{task_id}
 */
interface TaskUpdateRequest {
  /** Task title (required, 1-500 chars, non-empty) */
  title: string;

  /** Task description (optional, max 5000 chars) */
  description?: string | null;

  /** Task completion status (required) */
  completed: boolean;
}
```

### Update Task (Partial)

```typescript
/**
 * Request body for partial task update.
 * PATCH /api/users/{user_id}/tasks/{task_id}
 */
interface TaskPartialUpdateRequest {
  /** Task title (optional, 1-500 chars if provided) */
  title?: string;

  /** Task description (optional) */
  description?: string | null;

  /** Task completion status (optional) */
  completed?: boolean;
}
```

---

## API Response Types

### Success Response (Single Task)

```typescript
/**
 * API response containing a single task.
 * Used by: POST, GET (single), PUT, PATCH
 */
type TaskResponse = Task;
```

### Success Response (Task List)

```typescript
/**
 * API response containing multiple tasks.
 * Used by: GET (list)
 */
type TaskListResponse = Task[];
```

### Error Response

```typescript
/**
 * API error response format.
 * Backend returns { "detail": "..." } for errors.
 */
interface ApiError {
  /** Error message describing what went wrong */
  detail: string;
}
```

---

## Frontend State Types

### Task List State

```typescript
/**
 * State for the task list component.
 */
interface TaskListState {
  /** All tasks loaded from the API */
  tasks: Task[];

  /** Whether initial load is in progress */
  isLoading: boolean;

  /** Error message from failed operations */
  error: string | null;

  /** ID of task currently being edited (null if none) */
  editingTaskId: number | null;

  /** ID of task with pending delete confirmation */
  deletingTaskId: number | null;
}
```

### Form State

```typescript
/**
 * State for the create/edit task form.
 */
interface TaskFormState {
  /** Current title input value */
  title: string;

  /** Current description input value */
  description: string;

  /** Whether form submission is in progress */
  isSubmitting: boolean;

  /** Validation error message */
  validationError: string | null;
}
```

### Operation State

```typescript
/**
 * State for tracking pending API operations.
 * Used for loading indicators on individual tasks.
 */
interface OperationState {
  /** Set of task IDs with pending toggle operations */
  togglingIds: Set<number>;

  /** Set of task IDs with pending update operations */
  updatingIds: Set<number>;

  /** Set of task IDs with pending delete operations */
  deletingIds: Set<number>;
}
```

---

## Validation Rules

### Title Validation

| Rule | Value | Error Message |
|------|-------|---------------|
| Required | Yes | "Title is required" |
| Min length | 1 character | "Title cannot be empty" |
| Max length | 500 characters | "Title must be 500 characters or less" |
| Whitespace-only | Not allowed | "Title cannot be empty" |

### Description Validation

| Rule | Value | Error Message |
|------|-------|---------------|
| Required | No | - |
| Max length | 5000 characters | "Description must be 5000 characters or less" |

---

## Type Export Structure

```typescript
// lib/api/types.ts

export interface Task { ... }
export interface TaskCreateRequest { ... }
export interface TaskUpdateRequest { ... }
export interface TaskPartialUpdateRequest { ... }
export interface ApiError { ... }

// lib/types/state.ts

export interface TaskListState { ... }
export interface TaskFormState { ... }
export interface OperationState { ... }
```

---

## Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                          Frontend                                │
│                                                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │  TaskForm    │───▶│  API Client  │───▶│  TaskList    │       │
│  │  (Create)    │    │              │    │  (Display)   │       │
│  └──────────────┘    │              │    └──────────────┘       │
│                      │              │            │               │
│  ┌──────────────┐    │  TaskCreate  │    ┌──────────────┐       │
│  │  TaskItem    │◀───│  Request     │    │  TaskItem    │       │
│  │  (Toggle)    │    │              │    │  (Edit/Del)  │       │
│  └──────────────┘    └──────────────┘    └──────────────┘       │
│         │                   │                    │               │
│         ▼                   ▼                    ▼               │
│    TaskPartial         TaskUpdate           DELETE               │
│    Update Req          Request              /api/...             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Backend API (FastAPI)                         │
│                                                                  │
│  GET /api/users/{user_id}/tasks         → Task[]                 │
│  POST /api/users/{user_id}/tasks        → Task                   │
│  GET /api/users/{user_id}/tasks/{id}    → Task | 404             │
│  PUT /api/users/{user_id}/tasks/{id}    → Task | 404             │
│  PATCH /api/users/{user_id}/tasks/{id}  → Task | 404             │
│  DELETE /api/users/{user_id}/tasks/{id} → 204 | 404              │
└─────────────────────────────────────────────────────────────────┘
```

---

## Alignment with Backend

| Frontend Type | Backend Schema | Match |
|--------------|----------------|-------|
| `Task` | `TaskResponse` | ✅ |
| `TaskCreateRequest` | `TaskCreate` | ✅ |
| `TaskUpdateRequest` | `TaskUpdate` | ✅ |
| `TaskPartialUpdateRequest` | `TaskPartialUpdate` | ✅ |
| `ApiError` | FastAPI HTTPException | ✅ |
